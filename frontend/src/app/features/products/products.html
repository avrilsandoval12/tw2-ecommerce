<div class="container mt-4">
    <div class="d-flex justify-content-end mb-3">
      <button class="btn btn-outline-secondary" (click)="toggleSidebar()">
        <i class="bi bi-funnel-fill"></i> Filtros
      </button>
    </div>

    <!-- Sidebar -->
    <div
      class="filters-sidebar position-fixed top-0 end-0 vh-100 bg-light shadow p-3"
      [class.show]="sidebarOpen"
    >
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5>Filtros</h5>
        <button class="btn-close" (click)="toggleSidebar()"></button>
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Buscar producto</label>
        <input
          type="text"
          class="form-control"
          [ngModel]="filters().name"
          (ngModelChange)="updateFilter('name', $event)"
          placeholder="Ej: bolso, tote..."
        />
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Categoría</label>
        <select
          class="form-select"
          [ngModel]="filters().category"
          (ngModelChange)="updateFilter('category', $event)"
        >
          <option value="">Todas</option>
          <option *ngFor="let cat of categories()" [value]="cat.name">
            {{ cat.name }}
          </option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Rango de precios</label>

        <div class="range-container">
          <div class="slider-track"></div>
            <input
              type="range"
              [min]="precioMinGlobal"
              [max]="precioMaxGlobal"
              step="1000"
              [value]="minValue"
              (input)="onRangeChangeMin($event)"
              />
            <input
              type="range"
              [min]="precioMinGlobal"
              [max]="precioMaxGlobal"
              step="1000"
              [value]="maxValue"
              (input)="onRangeChangeMax($event)"
            />
          </div>

          <div class="d-flex justify-content-between mt-2 text-muted">
            <small>Desde: {{ minValue | currency:'ARS' }}</small>
            <small>Hasta: {{ maxValue | currency:'ARS' }}</small>
          </div>
        </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Ordenar por</label>
          <select
            class="form-select"
            [value]="filters().sort || ''"
            (change)="updateFilter('sort', $any($event.target).value)"
          >
            <option value="">Sin orden</option>
            <option value="priceAsc">Precio: menor a mayor</option>
            <option value="priceDesc">Precio: mayor a menor</option>
            <option value="nameAsc">Nombre (A → Z)</option>
            <option value="categoryAsc">Categoría (A → Z)</option>
          </select>
      </div>

      <div class="d-grid mt-4">
        <button class="btn btn-outline-secondary" (click)="clearFilters()">Limpiar filtros</button>
      </div>
    </div>

    <div class="row g-4">
      <div
        class="col-12 col-sm-6 col-md-4 col-lg-3"
        *ngFor="let product of productService.productosFiltrados()"
      >
        <app-product-card [product]="product"></app-product-card>
      </div>
    </div>
</div>
