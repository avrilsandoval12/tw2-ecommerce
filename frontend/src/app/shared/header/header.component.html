<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm sticky-top" style="background-color: #efefef;">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" routerLink="/">
      <img src="/silhouette.png" alt="Logo" height="30" />
    </a>

    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>



    <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a
            class="nav-link"
            routerLink="/products"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            >Productos</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            routerLink="/orders"
            routerLinkActive="active"
            >Mis pedidos</a
          >
        </li>
      </ul>
      <ul class="navbar-nav align-items-center gap-2">
        <li class="nav-item">
              <button
                class="btn btn-link nav-link position-relative p-0 border-0 text-decoration-none"
                (click)="toggleCart()"
                type="button">
                <i class="bi bi-cart fs-5"></i>
                @if (cartService.totalItems() > 0) {
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                    {{ cartService.totalItems() }}
                  </span>
                }
              </button>
            </li>



           <li class="nav-item">
                <a routerLink="/signin" class="btn btn-primary btn-sm">Iniciar sesión</a>
            </li>
            <li class="nav-item">
              <a routerLink="/signup" class="btn btn-outline-secondary btn-sm">Registrarse</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>



      @if (isCartOpen()) {
      <div
        class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-25"
        style="z-index: 1040;"
        (click)="closeCart()">
      </div>
      <div
        class="position-fixed bg-white rounded shadow-lg border"
        style="top: 70px; right: 20px; width: 400px; max-width: calc(100vw - 40px); z-index: 1050;">
        <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
          <h5 class="mb-0 fw-bold">Mi Carrito</h5>
          <button
            type="button"
            class="btn-close"
            (click)="closeCart()"
            aria-label="Close">
          </button>
        </div>
        @if (cartService.items().length === 0) {
          <div class="text-center py-5 text-muted">
            <i class="bi bi-cart-x display-4 d-block mb-3"></i>
            <p class="mb-0">Tu carrito está vacío</p>
          </div>
        } @else {
          <div class="p-3 overflow-auto" style="max-height: 400px;">
            @for (item of cartService.items(); track item.product.id) {
              <div class="card mb-2 border">
                <div class="card-body p-3">
                  <div class="d-flex gap-3">
                    <img
                      [src]="item.product.imagen || 'assets/no-image.png'"
                      [alt]="item.product.nombre"
                      class="rounded"
                      style="width: 60px; height: 60px; object-fit: cover;">

                    <div class="flex-grow-1">
                      <h6 class="mb-1 fw-semibold">{{ item.product.nombre }}</h6>
                      <p class="mb-1 text-muted small">
                        ${{ item.product.precio | number:'1.2-2' }} × {{ item.quantity }}
                      </p>
                      <p class="mb-0 fw-bold text-success">
                        ${{ (item.product.precio * item.quantity) | number:'1.2-2' }}
                      </p>
                    </div>

                    <button
                      class="btn btn-link text-danger p-0 border-0 align-self-start"
                      (click)="removeItem(item.product.id)"
                      title="Eliminar">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
          <div class="border-top p-3 bg-light">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="fw-semibold">Total:</span>
              <strong class="fs-5 text-success">
                ${{ cartService.totalPrice() | number:'1.2-2' }}
              </strong>
            </div>

            <a
              routerLink="/cart"
              class="btn btn-dark w-100 d-block text-center text-decoration-none"
              (click)="closeCart()">
              Ver Carrito Completo
            </a>
          </div>
        }
      </div>
    }
